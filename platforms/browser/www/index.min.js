/*! BBC-Colour v0.0.1 (Monday 7th August 2017, 5:13:09 PM) */
var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),t;!function(t){var a=function(a){function n(e){var t=a.call(this,e)||this;return t.state={},t}return e(n,a),n.prototype.render=function(){this.state,this.props;return React.createElement("article",null,React.createElement(t.ImageComponent,null))},n}(React.Component);t.App=a}(t||(t={}));var t;!function(t){var a=function(t){function a(){var e=null!==t&&t.apply(this,arguments)||this;return e.resize=function(){var t=e.canvas;if(t){var a=t.getBoundingClientRect();t.width,a.width,t.height!==a.height&&(e.ctx=t.getContext("2d")).clearRect(0,0,t.width=a.width,t.height=a.height)}},e}return e(a,t),a.prototype.render=function(){var e=this,t=this.props;return React.createElement("canvas",{key:"canvas",onClick:t.onClick||null,onMouseMove:t.onMouseMove||null,onMouseUp:t.onMouseUp||null,onTouchMove:t.onTouchMove||null,onTouchEnd:t.onTouchEnd||null,ref:function(t){e.canvas=t,e.resize()},width:t.width||null,height:t.height||null})},a}(React.Component);t.CanvasComponent=a}(t||(t={}));var t;!function(t){var a=20,n={aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blueviolet:[138,43,226],blue:[0,0,255],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],grey:[128,128,128],greenyellow:[173,255,47],green:[0,128,0],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavenderblush:[255,240,245],lavender:[230,230,250],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgrey:[211,211,211],lightgreen:[144,238,144],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],lime:[0,255,0],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olivedrab:[107,142,35],olive:[128,128,0],orangered:[255,69,0],orange:[255,165,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],white:[255,255,255],yellowgreen:[154,205,50],yellow:[255,255,0]},o=function(o){function r(e){var t=o.call(this,e)||this;return t.image=new Image,t.want="green",t.getColours=function(e,o){if(t.state.left!==e||t.state.top!==o){var r,i,l=t.canvasComponent.ctx.getImageData(e-a,o-a,2*a,2*a).data,s={};for(i in n)s[i]=0;for(r=0;r<l.length;r+=4){var c=l[r],u=l[r+1],d=l[r+2],h=void 0,g=void 0;for(i in n){var m=n[i],p=(c+m[0])/2,v=(2+p/256)*Math.pow(c-m[0],2)+4*Math.pow(u-m[1],2)+(2+(255-p)/256)*Math.pow(d-m[2],2);(void 0===h||h>v)&&(h=v,g=i)}g&&s[g]++}t.setState({total:l.length/4,left:e,top:o}),t.setState(s)}},t.loadImage=function(){var e=t.canvasComponent.canvas,a=t.canvasComponent.ctx,n=e.width/2,o=e.height/2,r=t.image,i=r.naturalWidth>r.naturalHeight!=e.width>e.height;a.clearRect(0,0,e.width,e.height),a.save(),a.translate(n,o),i?(a.rotate(Math.PI/2),a.drawImage(r,-o,-n,e.height,e.width)):a.drawImage(r,-n,-o,e.width,e.height),a.restore(),t.setState({hasImage:!0})},t.handleFiles=function(e){var a=e.target.files[0];if(a){var n=new FileReader;n.onloadend=function(e){var a=t.image;a.onload=t.loadImage,a.src=n.result},n.readAsDataURL(a)}},t.clickCanvas=function(e){t.state.hasImage&&t.getColours(e.pageX,e.pageY)},t.touchCanvas=function(e){t.state.hasImage&&t.getColours(e.changedTouches[0].pageX,e.changedTouches[0].pageY)},t.capturePhotoWithFile=function(e){var a=navigator.camera;a.getPicture(function(e){var a=t.image;a.onload=t.loadImage,a.src=e},void 0,{quality:70,destinationType:a.DestinationType.FILE_URI,allowEdit:!0,correctOrientation:!0})},t.nextColour=function(){t.want="green"===t.want?"blue":"green",t.lastBest=void 0,t.correctTimeout=0,t.setState({total:0})},t.changeText=function(){t.text=void 0,t.textTimeout=0,t.forceUpdate()},t.image.crossOrigin="anonymous",t.state={total:0,left:0,top:0},window.addEventListener("orientationchange",function(){t.state.hasImage&&t.forceUpdate(t.loadImage)}),t}return e(r,o),r.prototype.render=function(){var e,a=this,o=this.state,r=(this.props,o.total?Object.keys(n).reduce(function(e,t){return(o[e]||0)>(o[t]||0)?e:t}):null),i=r&&r.indexOf(this.want)>=0;return i?(this.correctTimeout||(this.correctTimeout=setTimeout(this.nextColour,8e3)),e="Good job!"):e=r?"Try again":"Let's find something "+this.want+"!",this.text?this.text===e&&this.lastBest===r||(this.textTimeout||(this.textTimeout=setTimeout(this.changeText,300)),e=this.text,this.lastBest=r):this.text=e,React.createElement("div",{className:"histogram"+(this.state.hasImage?" image":"")+(i?" correct":"")},React.createElement(t.CanvasComponent,{ref:function(e){a.canvasComponent=e},onClick:this.clickCanvas,onTouchMove:this.touchCanvas,onTouchEnd:this.touchCanvas}),React.createElement("label",{className:"camera",style:null},React.createElement("input",{type:"file",accept:"image/*",onChange:this.handleFiles})),React.createElement("button",{style:{display:"none"},onClick:this.capturePhotoWithFile}),React.createElement("div",{className:"character"},React.createElement("div",{"data-text":e,style:{color:this.want,opacity:this.textTimeout?0:1}})),React.createElement("div",{className:"frame"},React.createElement("span",null),React.createElement("span",null),React.createElement("span",null)),React.createElement("span",{key:"color",style:o.total?{left:o.left,top:o.top,color:r}:{display:"none"}},React.createElement("span",null,o.total?r:null)),React.createElement("div",{className:"success"}))},r}(React.Component);t.ImageComponent=o}(t||(t={}));var a=!1;!function(e,n){function o(){var o,r=e.documentElement;n.addEventListener("options-test",null,Object.defineProperty({},"capture",{get:function(){var t=e.addEventListener;if(!t.isTouched){var a=function(e,a,n,o){switch(e){case"touchstart":case"touchmove":case"touchend":!0===n||!1===n?n={capture:n}:n||(n={}),n.passive||(n.passive=!1)}return t.call(this,e,a,n,o)};a.isTouched=!0,Object.defineProperty(e,"addEventListener",{value:a,configurable:!0}),Object.defineProperty(e.body,"addEventListener",{value:a,configurable:!0})}}})),"ontouchstart"in r||/Mobile/.test(navigator.userAgent)?e.body.addEventListener("touchstart",function(e){var t=e.timeStamp,a=t-(parseFloat(e.currentTarget.dataset.lastTouch)||t);e.currentTarget.dataset.lastTouch=String(t),a&&a<500&&e.touches.length<=1&&e.preventDefault()},!0):(a=!0,r.classList.add("desktop")),e.addEventListener("touchstart",function(){o=!0}),e.addEventListener("touchmove",function(e){o&&(e.preventDefault(),o=!1)},{passive:!1}),ReactDOM.render(React.createElement(t.App,null),e.body)}/complete|loaded|interactive/.test(e.readyState)&&e.body?o():e.addEventListener("DOMContentLoaded",o,!1)}(document,window);